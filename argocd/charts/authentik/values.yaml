authentik:
  # Use external secret for the secret key
  secret_key:
    valueFrom:
      secretKeyRef:
        name: authentik-secret-key
        key: AUTHENTIK_SECRET_KEY

  # Disable built-in PostgreSQL and Redis
  postgresql:
    enabled: false

  redis:
    enabled: false

  # Environment variables from secrets
  env:
  - name: AUTHENTIK_POSTGRESQL__HOST
    valueFrom:
      secretKeyRef:
        name: authentik-db-secret
        key: AUTHENTIK_POSTGRESQL__HOST
  - name: AUTHENTIK_POSTGRESQL__NAME
    valueFrom:
      secretKeyRef:
        name: authentik-db-secret
        key: AUTHENTIK_POSTGRESQL__NAME
  - name: AUTHENTIK_POSTGRESQL__USER
    valueFrom:
      secretKeyRef:
        name: authentik-db-secret
        key: AUTHENTIK_POSTGRESQL__USER
  - name: AUTHENTIK_POSTGRESQL__PASSWORD
    valueFrom:
      secretKeyRef:
        name: authentik-db-secret
        key: AUTHENTIK_POSTGRESQL__PASSWORD
  - name: AUTHENTIK_REDIS__HOST
    valueFrom:
      secretKeyRef:
        name: authentik-redis-secret
        key: AUTHENTIK_REDIS__HOST
  - name: AUTHENTIK_LISTEN__HTTP
    value: "0.0.0.0:9000"
  - name: AUTHENTIK_LISTEN__HTTPS
    value: "0.0.0.0:9443"

server:
  replicas: 1

  service:
    type: LoadBalancer
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"

worker:
  replicas: 1

resources:
  server:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  worker:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
